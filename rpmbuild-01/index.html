<!-- build time:Mon Jun 03 2019 17:38:36 GMT+0800 (China Standard Time) --><!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/black/pace-theme-flash.min.css" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.css" rel="stylesheet" type="text/css"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="linux,持续集成,CI,"><link rel="alternate" href="/atom.xml" title="编程三分钟" type="application/atom+xml"><meta name="description" content="摘要：rpm包是预先在Linux主机上编译好并打包的文件，安装起来非常快捷。不需要再进行繁琐的编译等操作，拿来就能用，区别于yum包管理，rpm可以在不需要网络环境的情况下使用。学习完大神的文章还是有一些细节不太清楚，下面我就再对编译RPM包的过程和详细知识点再梳理扩展一下留作备忘。"><meta name="keywords" content="linux,持续集成,CI"><meta property="og:type" content="article"><meta property="og:title" content="如何无网络下免编译的安装程序（RPM包）"><meta property="og:url" content="https://qupzhi.com/rpmbuild-01/index.html"><meta property="og:site_name" content="编程三分钟"><meta property="og:description" content="摘要：rpm包是预先在Linux主机上编译好并打包的文件，安装起来非常快捷。不需要再进行繁琐的编译等操作，拿来就能用，区别于yum包管理，rpm可以在不需要网络环境的情况下使用。学习完大神的文章还是有一些细节不太清楚，下面我就再对编译RPM包的过程和详细知识点再梳理扩展一下留作备忘。"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2019-05-01T14:54:12.315Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="如何无网络下免编译的安装程序（RPM包）"><meta name="twitter:description" content="摘要：rpm包是预先在Linux主机上编译好并打包的文件，安装起来非常快捷。不需要再进行繁琐的编译等操作，拿来就能用，区别于yum包管理，rpm可以在不需要网络环境的情况下使用。学习完大神的文章还是有一些细节不太清楚，下面我就再对编译RPM包的过程和详细知识点再梳理扩展一下留作备忘。"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://qupzhi.com/rpmbuild-01/"><title>如何无网络下免编译的安装程序（RPM包） | 编程三分钟</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">编程三分钟</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">微信公众号 coding3min</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>站点地图</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://qupzhi.com/rpmbuild-01/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="编程三分钟"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="编程三分钟"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">如何无网络下免编译的安装程序（RPM包）</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-28T00:45:00+08:00">2019-04-28 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span> </a></span></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/rpmbuild-01/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/rpmbuild-01/" itemprop="commentCount"></span> </a></span><span id="/rpmbuild-01/" class="leancloud_visitors" data-flag-title="如何无网络下免编译的安装程序（RPM包）"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数&#58;</span> <span class="leancloud-visitors-count"></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">2,810 字 </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">12 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><p>摘要：rpm包是预先在Linux主机上编译好并打包的文件，安装起来非常快捷。不需要再进行繁琐的编译等操作，拿来就能用，区别于yum包管理，rpm可以在不需要网络环境的情况下使用。学习完<a href="https://jeremy-xu.oschina.io/2018/02/centos6%25252525E4%25252525B8%252525258Brpm%25252525E6%2525252589%2525252593%25252525E5%252525258C%2525252585%25252525E5%25252525AE%252525259E%25252525E6%2525252588%2525252598/" target="_blank" rel="noopener">大神的文章</a>还是有一些细节不太清楚，下面我就再对编译RPM包的过程和详细知识点再梳理扩展一下留作备忘。</p><a id="more"></a><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>redhat包管理器rpm（redhat package manager），因为非常的方便，所以这个方式被广泛的使用现在rpm的英文翻译是一种递归写法（RPM package manager）。RPM是以一种数据库记录的方式来将所需要的套件安装在Linux主机的一套管理程序。也就是说Linux系统中存在一个关于rpm的数据库，它记录了安装的包与包之间的依赖相关性。我们可以在有网的环境下载rpm包，也可以定制化的将自己的软件打成rpm包。</p><h1 id="准备rpm打包环境"><a href="#准备rpm打包环境" class="headerlink" title="准备rpm打包环境"></a>准备rpm打包环境</h1><p>我这里用的操作系统是CentOS6.7，redhat系的其它发行版应该也类似。</p><h2 id="安装rpm-build"><a href="#安装rpm-build" class="headerlink" title="安装rpm-build"></a>安装rpm-build</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y gcc make rpm-build redhat-rpm-config vim lrzsz</span><br></pre></td></tr></table></figure><h3 id="在无网络的机器上装备环境"><a href="#在无网络的机器上装备环境" class="headerlink" title="在无网络的机器上装备环境"></a>在无网络的机器上装备环境</h3><p>需要在无网络的情况下解决一些依赖包的环境可以使用以下命令提前在一台有网络的机器上下载好RPM包再到无网络的机器上安装就可以了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install --downloadonly --downloaddir=&lt;目录&gt;  &lt;packages&gt;</span><br></pre></td></tr></table></figure><h2 id="创建必须的文件夹和文件"><a href="#创建必须的文件夹和文件" class="headerlink" title="创建必须的文件夹和文件"></a>创建必须的文件夹和文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/rpmbuild/&#123;BUILD,RPMS,SOURCES,SPECS,SRPMS&#125;echo &apos;%\_topdir %(echo $HOME)/rpmbuild&apos; &gt; ~/.rpmmacros</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left">文件名</th><th style="text-align:left">类型</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">SPECS</td><td style="text-align:left">目录</td><td style="text-align:left">包含rpm的xxx.spec文件(打包的描述文件)</td></tr><tr><td style="text-align:left">SOURCES</td><td style="text-align:left">目录</td><td style="text-align:left">包含源码包(如.tar包)和所有patch补丁、service启动文件等</td></tr><tr><td style="text-align:left">BUILD</td><td style="text-align:left">目录</td><td style="text-align:left">源码包被解压至此, 并在该目录的子目录完成编译</td></tr><tr><td style="text-align:left">BUILDROOT</td><td style="text-align:left">目录</td><td style="text-align:left">存放编译后的文件的临时目录(保存%install阶段安装的文件)</td></tr><tr><td style="text-align:left">RPMS</td><td style="text-align:left">目录</td><td style="text-align:left">经过编译成功后, 打包文件放在这个目录, 包含i386、i686、noarch等次级目录</td></tr><tr><td style="text-align:left">SRPMS</td><td style="text-align:left">目录</td><td style="text-align:left">包含.src.rpm的SPRM包(通常用于审核和升级软件包)</td></tr></tbody></table><h2 id="制作spec文件"><a href="#制作spec文件" class="headerlink" title="制作spec文件"></a>制作spec文件</h2><blockquote><p>找spec模板文件</p></blockquote><p>一般找一个类似的rpm源码包，将其安装，然后参照它写自己软件包的spec文件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/rpms</span><br><span class="line">wget -O ~/rpms/python-2.6.6-64.el6.src.rpm http://vault.centos.org/6.7/os/Source/SPackages/python-2.6.6-64.el6.src.rpm</span><br><span class="line">rpm -ivh ~/rpms/python-2.6.6-64.el6.src.rpm</span><br><span class="line">vim ~/rpmbuild/SPECS/python.spec # 参照这个文件来写自己软件包的spec文件</span><br></pre></td></tr></table></figure><h3 id="rpmbuild内置变量"><a href="#rpmbuild内置变量" class="headerlink" title="rpmbuild内置变量"></a>rpmbuild内置变量</h3><p><code>rpmbuild --showrc</code>可查看内置的变量</p><p>常用的几个变量:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$RPM_BUILD_DIR /$HOME/rpmbuild/BUILD</span><br><span class="line">$RPM_BUILD_ROOT /$HOME/rpmbuild/BUILDROOT</span><br><span class="line">%&#123;_sysconfigdir&#125; /etc</span><br><span class="line">%&#123;_sbindir&#125; /usr/sbin</span><br><span class="line">%&#123;_bindir&#125; /usr/bin</span><br><span class="line">%&#123;_prefix&#125; /usr</span><br><span class="line">%&#123;_localstatedir&#125; /var</span><br><span class="line"></span><br><span class="line">更多的可以查看 --showrc</span><br></pre></td></tr></table></figure><h3 id="rpmbuild-spec规范说明"><a href="#rpmbuild-spec规范说明" class="headerlink" title="rpmbuild spec规范说明"></a>rpmbuild spec规范说明</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Summary: 软件包的内容概要描述</span><br><span class="line">Name: 软件包的名称(spec文件名与其一致)</span><br><span class="line">Version: 软件的实际版本号，具体和源码包一致</span><br><span class="line">Release: 软件包的发布实际版本号</span><br><span class="line">Url: 软件的主页</span><br><span class="line">License: 软件授权方式(GPL等)</span><br><span class="line">Group: 软件分组，如(Application/System)</span><br><span class="line">Source: 软件的来源</span><br><span class="line">Patch: 补丁patch file依赖的软件，安装的时候需要检查的</span><br><span class="line">BuildRoot: 安装或者编译时使用的&quot;虚拟目录&quot;，一般默认 </span><br><span class="line">BuildRequires: 编译过程中需要的软件</span><br><span class="line">Requires: 依赖的软件, 安装的时候需要检查的</span><br><span class="line">Packager: 软件的打包者</span><br><span class="line">Vendor: 软件发行商或者打包组织信息,如(Apache Software Foundation)</span><br><span class="line"></span><br><span class="line">%description: 软件包描述</span><br><span class="line">%prep: 编译前预处理。如: 1.打补丁; 2. 解压源码等</span><br><span class="line">%setup: 解压源码(一般是位于%prep下的macro, 自动解压源码)</span><br><span class="line">%build: 编译</span><br><span class="line">%install: 安装, 即把一些可执行文件和配置复制到目标目录中。</span><br><span class="line">%clean: 清理一些暂存文件</span><br><span class="line">%files: 定义哪些文件或者目录会放入rpm中</span><br><span class="line">%pre: rpm安装前执行的动作</span><br><span class="line">%post: rpm安装后执行的动作</span><br><span class="line">%preun: 卸载前执行脚本程序(preun)开始执行</span><br><span class="line">%postun: 卸载后执行脚本程序(postun)开始执行</span><br></pre></td></tr></table></figure><p>更多参考: <a href="https://fedoraproject.org/wiki/How_to_create_an_RPM_package/zh-cn" target="_blank" rel="noopener">How_to_create_an_RPM_package</a></p><h3 id="rpmbuild-spec-示例"><a href="#rpmbuild-spec-示例" class="headerlink" title="rpmbuild spec 示例"></a>rpmbuild spec 示例</h3><p>示例1 openstack-aodh.spec</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">%global pypi_name aodh</span><br><span class="line">%&#123;!?upstream_version: %global upstream_version %&#123;version&#125;%&#123;?milestone&#125;&#125;</span><br><span class="line">Name:       openstack-aodh</span><br><span class="line">Version:    2.0.0</span><br><span class="line">Release:    %&#123;es_versions&#125;%&#123;?dist&#125;</span><br><span class="line">Summary:    OpenStack Telemetry Alarming</span><br><span class="line">License:    ASL 2.0</span><br><span class="line">URL:        https://github.com/openstack/aodh.git</span><br><span class="line">BuildArch:  noarch</span><br><span class="line">Source0:    http://tarballs.openstack.org/%&#123;pypi_name&#125;/%&#123;pypi_name&#125;-%&#123;version&#125;.tar.gz</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">%description</span><br><span class="line">Aodh is the alarm engine of the Ceilometer project.</span><br><span class="line"></span><br><span class="line">%prep</span><br><span class="line">%setup -q -n %&#123;pypi_name&#125;-%&#123;upstream_version&#125;</span><br><span class="line"></span><br><span class="line">%build</span><br><span class="line">%&#123;__python2&#125; setup.py build</span><br><span class="line"></span><br><span class="line">%install</span><br><span class="line">%&#123;__python2&#125; setup.py install --skip-buid --root %&#123;buildroot&#125;</span><br><span class="line"></span><br><span class="line">%files -n python-aodh</span><br><span class="line">%&#123;python2_sitelib&#125;/aodh</span><br><span class="line">... </span><br><span class="line">%files common</span><br><span class="line">%doc README.rst</span><br><span class="line">%dir %&#123;_sysconfdir&#125;/aodh</span><br><span class="line">%attr(-, root, aodh) %&#123;_datadir&#125;/aodh/aodh-dist.conf</span><br><span class="line">%config(noreplace) %attr(-, root, aodh) %&#123;_sysconfdir&#125;/aodh/aodh.conf</span><br><span class="line">...</span><br><span class="line">%changelog</span><br></pre></td></tr></table></figure><p>示例2 mariadb.spec</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">%define debug_package %&#123;nil&#125;</span><br><span class="line">%define install_dir /usr/local/mariadb</span><br><span class="line"></span><br><span class="line">Name:		mariadb</span><br><span class="line">Version:	10.1.20</span><br><span class="line">Release:	1%&#123;?dist&#125;</span><br><span class="line">Summary:	Mariadb client programs and shared libraries and server programs</span><br><span class="line"></span><br><span class="line">Group:		Applications/Databases</span><br><span class="line">License:	GPLv2 with exceptions</span><br><span class="line">URL:		https://mariadb.org/</span><br><span class="line">Source0:	mariadb-10.1.20.tar.gz</span><br><span class="line"></span><br><span class="line">BuildRoot: %&#123;_tmppath&#125;/%&#123;name&#125;-%&#123;version&#125;-%&#123;release&#125;-root</span><br><span class="line">BuildRequires: readline-devel, openssl-devel</span><br><span class="line">BuildRequires: gcc-c++, ncurses-devel, zlib-devel</span><br><span class="line">BuildRequires: libtool, automake, autoconf, gawk</span><br><span class="line">Requires:      grep, automake, autoconf, bash</span><br><span class="line">Autoreq:	0</span><br><span class="line"></span><br><span class="line">%description</span><br><span class="line">MariaDB Server is one of the most popular database servers in the world. It’s made by the original developers of MySQL and guaranteed to stay open source. Notable users include Wikipedia, WordPress.com and Google.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">%prep</span><br><span class="line">%setup -q</span><br><span class="line"></span><br><span class="line">%build</span><br><span class="line">cmake . -DMYSQL_UNIX_ADDR=/tmp/mariadb.sock \</span><br><span class="line">        -DEXTRA_CHARSETS=all \</span><br><span class="line">        -DMYSQL_USER=mysql \</span><br><span class="line">        -DCMAKE_INSTALL_PREFIX=%&#123;install_dir&#125; \</span><br><span class="line">        -DMYSQL_DATADIR=/data/mariadb  \</span><br><span class="line">        -DWITH_XTRADB_STORAGE_ENGINE=1 \</span><br><span class="line">        -DWITH_FEDERATEDX_STORAGE_ENGINE=1 \</span><br><span class="line">        -DWITH_ARCHIVE_STORAGE_ENGINE=1 \</span><br><span class="line">        -DWITH_MYISAM_STORAGE_ENGINE=1 \</span><br><span class="line">        -DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line">        -DWITH_ARCHIVE_STPRAGE_ENGINE=1 \</span><br><span class="line">        -DWITH_BLACKHOLE_STORAGE_ENGINE=1 \</span><br><span class="line">        -DWITH_SSL=system \</span><br><span class="line">        -DVITH_ZLIB=system \</span><br><span class="line">        -DWITH_LOBWRAP=0 \</span><br><span class="line">        -DDEFAULT_CHARSET=utf8 \</span><br><span class="line">        -DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line">        -DENABLED_LOCAL_INFILE=ON \</span><br><span class="line">        -DWITH_PARTITION_STORAGE_ENGINE=1 \</span><br><span class="line">        -DWITH_PERFSCHEMA_STORAGE_ENGINE=1 \</span><br><span class="line">        -DWITH_READLINE=ON \</span><br><span class="line">        -DWITH_WSREP=ON \</span><br><span class="line">        -DWITH_INNODB_DISALLOW_WRITES=ON \</span><br><span class="line">        -DWITH_TOKUDB=1 \</span><br><span class="line">        -DCMAKE_CXX_COMPILER:FILEPATH=/usr/bin/g++ \</span><br><span class="line">        -DCMAKE_C_COMPILER:FILEPATH=/usr/bin/gcc \</span><br><span class="line">        -DCMAKE_BUILD_TYPE:STRING=RELEASE</span><br><span class="line">make %&#123;?_smp_mflags&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">%install</span><br><span class="line">rm -rf %&#123;buildroot&#125;</span><br><span class="line">make install DESTDIR=%&#123;buildroot&#125;</span><br><span class="line"></span><br><span class="line">%pre</span><br><span class="line">groupadd -r mysql 2&gt; /dev/null</span><br><span class="line">useradd -g mysql -r -M -s /sbin/nologin mysql 2&gt; /dev/null</span><br><span class="line">mkdir -p /data/mariadb/data 2&gt; /dev/null</span><br><span class="line">mkdir -p /data/mariadb/binlog 2&gt; /dev/null</span><br><span class="line">mkdir -p /data/mariadb/undolog 2&gt; /dev/null</span><br><span class="line">mkdir -p /var/run/mariadb/ 2&gt; /dev/null</span><br><span class="line">mkdir -p /var/log/mariadb/ 2&gt; /dev/null</span><br><span class="line">chown -R mysql.mysql /var/run/mariadb/ 2&gt; /dev/null</span><br><span class="line">chown -R mysql.mysql /var/log/mariadb/ 2&gt; /dev/null</span><br><span class="line">chown -R mysql.mysql /data/mariadb 2&gt; /dev/null</span><br><span class="line"></span><br><span class="line">%clean </span><br><span class="line">rm -rf %&#123;buildroot&#125; </span><br><span class="line"></span><br><span class="line">%files</span><br><span class="line">%defattr(-, root, root, 0755)</span><br><span class="line">%&#123;install_dir&#125;/</span><br><span class="line">%doc</span><br><span class="line"></span><br><span class="line">%changelog</span><br></pre></td></tr></table></figure><p>spec更加详细内容见 <a href="https://blog.csdn.net/XXJ19950917/article/details/81868456" target="_blank" rel="noopener">这里</a></p><h1 id="制作rpm包"><a href="#制作rpm包" class="headerlink" title="制作rpm包"></a>制作rpm包</h1><h2 id="上传必要的source文件"><a href="#上传必要的source文件" class="headerlink" title="上传必要的source文件"></a>上传必要的source文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp $&#123;some_where&#125;/Python-2.7.10.tgz ~/rpmbuild/SOURCES/</span><br></pre></td></tr></table></figure><h2 id="开始制作"><a href="#开始制作" class="headerlink" title="开始制作"></a>开始制作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/rpmbuild</span><br><span class="line">rpmbuild -bb --target x86_64 SPECS/python27-tstack.spec &gt; rpmbuild.log  &amp;</span><br></pre></td></tr></table></figure><p>一切顺利的话，最终会在~/rpmbuild/RPMS/x86_64/目录下找到编译好的rpm包。</p><h2 id="技巧总结"><a href="#技巧总结" class="headerlink" title="技巧总结"></a>技巧总结</h2><ul><li>不打debug的rpm包:在spec文件中加入<code>%debug\_package %{nil}</code>即可</li><li>禁止自动分析源码添加不应该加入的依赖 在spec文件中加入<code>Autoreq: 0</code>即可</li><li>sepc文件中一些宏的用法 在spec文件中经常出现一些宏，比如<code>%setup</code>、<code>%patch</code>，这两个宏的选项较多，使用时要特别注意，参见这里</li><li>安装卸载rpm包前后的动作 可以通过<code>%pre</code>, <code>%post</code>, <code>%preun</code>, <code>%postun</code>指定rpm包在安装卸载前后的动作，比如在安装前用脚本做一些准备、在安装后用脚本做一些初始化动作、在卸载前用脚本做一些准备、在卸载后用脚本做一些清理动作</li></ul><p>rpmbuild命令的选项 rpmbuild命令有不少选项，参见<a href="http://ftp.rpm.org/max-rpm/rpmbuild.8.html" target="_blank" rel="noopener">这里</a>，用得比较多的有：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-bp 只解压源码及应用补丁</span><br><span class="line">-bc 只进行编译</span><br><span class="line">-bi 只进行安装到%&#123;buildroot&#125;</span><br><span class="line">-bb 只生成二进制rpm包</span><br><span class="line">-bs 只生成源码rpm包</span><br><span class="line">-ba 生成二进制rpm包和源码rpm包</span><br><span class="line">--target 指定生成rpm包的平台，默认会生成i686和x86_64的rpm包，但一般我只需要x86_64的rpm包</span><br></pre></td></tr></table></figure><h1 id="RPM-常用参数备忘"><a href="#RPM-常用参数备忘" class="headerlink" title="RPM 常用参数备忘"></a>RPM 常用参数备忘</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh ***.rpm: 安装软件(并且显示安装进度 --install--verbose--hash)</span><br><span class="line">rpm -Uvh ***.rpm: 升级软件(--Update)</span><br><span class="line">rpm -e: 卸载软件</span><br><span class="line">rpm -q [软件名称]: 查询程序是否安装</span><br><span class="line">rpm -qa: 查询已经安装的所有软件(Query All)</span><br><span class="line">rpm -qi [软件名称]: 列出该软件的详细信息</span><br><span class="line">rpm -qf [指定文件名]: 查找指定文件属于哪个RPM软件包(Query Files)</span><br><span class="line">rpm -qc [软件名称]: 列出该软件的所有文件</span><br><span class="line">rpm -qpi [软件名称]: 列出RPM软件包的描述信息(Query Packages install package(s))</span><br><span class="line">rpm -qpl [软件名称]: 列出该软件的所有文件(Query Packages list)</span><br><span class="line">rpm -qRp [软件名称]: 列出该软件的依赖(Query Rely Packages)</span><br><span class="line">rpm -Va [软件名称]: 校验所有的RPM软件包，查找丢失的文件(View List)</span><br></pre></td></tr></table></figure><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><h2 id="如何从python源码包构建rpm"><a href="#如何从python源码包构建rpm" class="headerlink" title="如何从python源码包构建rpm"></a>如何从python源码包构建rpm</h2><p>在python源码目录执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py bdist_rpm # 即可在当前dist目录下生成rpm包</span><br></pre></td></tr></table></figure><p>定制spec:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python setup.py bdist_rpm --spec-only # 只生成dist/&lt;module&gt;.spec</span><br><span class="line"># 重新编辑 dist/&lt;module&gt;.spec</span><br><span class="line">python setup.py bdist_rpm --spec-file=dist/&lt;module&gt;.spec</span><br></pre></td></tr></table></figure><h2 id="无污染地打rpm包"><a href="#无污染地打rpm包" class="headerlink" title="无污染地打rpm包"></a>无污染地打rpm包</h2><p>方法一、使用mock来进程打包，详细的过程可以见</p><p><a href="https://jeremy-xu.oschina.io/2018/04/centos%25E4%25B8%258B%25E6%2597%25A0%25E6%25B1%25A1%25E6%259F%2593%25E5%259C%25B0%25E6%2589%2593rpm%25E5%258C%2585/" target="_blank" rel="noopener">centos下无污染地打rpm包</a></p><blockquote><p>mock编包一般是做发行版本给别人使用，当然你做的软件要能在别人机器上跑，那么在开发过程中，我们必须模拟一个纯净的用户环境（即是所谓的chroot），mock在编包前先构建一个这样的用户环境，然后里面再使用rpmbuild的机制编包。</p></blockquote><p>总结来说，rpmbuild编出来的包是特例，而mock编出来包在具有共性。mock相当于给rpmbuild增加了一个外壳，包装了一下。</p><p>方法二、虚拟机操作</p><p>建议使用虚拟机操作，不要在自己的电脑上进行这些操作，不然到时候弄一大堆的包在自己电脑上很头疼的，如果没有虚拟机可以使用 <code>vagrant</code>在本地虚拟化出一个os进行操作 具体用法<a href="https://segmentfault.com/a/1190000000264347" target="_blank" rel="noopener">使用 Vagrant 打造跨平台开发环境</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir some-dir</span><br><span class="line"></span><br><span class="line">cd some-dir</span><br><span class="line"></span><br><span class="line">vagrant init centos/6</span><br><span class="line"></span><br><span class="line">vagrant up</span><br><span class="line"></span><br><span class="line">vagrant ssh</span><br></pre></td></tr></table></figure><p>这两种方法各有各的好处，mock感觉有点像dock，只要编译完成后直接删除该mock环境就行，更加的纯洁迅速； 而Vagrant如果没有理解错他就是在本地安装了一个虚拟机，比起mock更重一些，但是可以比较轻松的应对更多的场景，比如说在本地开发的时候代码可以在不同的时候上调试，以后有时间一定要学习下这两种方式。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>rpmbuild打包一般步骤</p><ul><li>根据rpmbuild标准，创建打包的目录结构</li><li>将源码和辅助文件放到指定目录</li><li>编写spec文件，放到指定目录</li><li>根据需要构建rpm，或者rpm和srpm等。</li></ul><p>无网络时提前在有网络的机器上下载好依赖包就好啦</p><h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p><a href="https://fedoraproject.org/wiki/How_to_create_an_RPM_package/zh-hk" target="_blank" rel="noopener">How to create an RPM package/zh-hk</a></p><p><a href="https://jeremy-xu.oschina.io/2018/02/centos6%25252525E4%25252525B8%252525258Brpm%25252525E6%2525252589%2525252593%25252525E5%252525258C%2525252585%25252525E5%25252525AE%252525259E%25252525E6%2525252588%2525252598/" target="_blank" rel="noopener">CentOS6下rpm打包实战</a></p><p><a href="http://www.dahouduan.com/2015/06/15/linux-centos-make-rpm/" target="_blank" rel="noopener">Centos 6 制作 rpm 包</a></p><p><a href="https://blog.csdn.net/XXJ19950917/article/details/81664234" target="_blank" rel="noopener">Linux之rpm本地打包</a></p><p><a href="https://blog.csdn.net/u012609847/article/details/41916393" target="_blank" rel="noopener">SRPM包编译成RPM包之rpmbuild和mock</a></p></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div><button id="rewardButton" disable="enable" onclick='var e=document.getElementById("QR");"none"===e.style.display?e.style.display="block":e.style.display="none"'><span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/images/wxpay.jpg" alt="编程三分钟 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"><img id="alipay_qr" src="/images/alipay.jpg" alt="编程三分钟 支付宝"><p>支付宝</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong> 小熊同学</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://qupzhi.com/rpmbuild-01/" title="如何无网络下免编译的安装程序（RPM包）">https://qupzhi.com/rpmbuild-01/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/持续集成/" rel="tag"># 持续集成</a> <a href="/tags/CI/" rel="tag"># CI</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/redis-better/" rel="next" title="Redis运行优化"><i class="fa fa-chevron-left"></i> Redis运行优化</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/process-start-time-linux/" rel="prev" title="进程启动时间采集（linux篇）">进程启动时间采集（linux篇） <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine@1.1.6/dist/Valine.min.js"></script><script>new Valine({av:AV,el:".comments",notify:"true",verify:!1,app_id:"",app_key:"",placeholder:""})</script></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="编程三分钟"><p class="site-author-name" itemprop="name">编程三分钟</p><p class="site-description motion-element" itemprop="description">编程三分钟，让编程没有难懂的事情</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">27</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">16</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">36</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/pzqu" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:pzqu@qq.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#准备rpm打包环境"><span class="nav-number">2.</span> <span class="nav-text">准备rpm打包环境</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装rpm-build"><span class="nav-number">2.1.</span> <span class="nav-text">安装rpm-build</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#在无网络的机器上装备环境"><span class="nav-number">2.1.1.</span> <span class="nav-text">在无网络的机器上装备环境</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建必须的文件夹和文件"><span class="nav-number">2.2.</span> <span class="nav-text">创建必须的文件夹和文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#制作spec文件"><span class="nav-number">2.3.</span> <span class="nav-text">制作spec文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#rpmbuild内置变量"><span class="nav-number">2.3.1.</span> <span class="nav-text">rpmbuild内置变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rpmbuild-spec规范说明"><span class="nav-number">2.3.2.</span> <span class="nav-text">rpmbuild spec规范说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rpmbuild-spec-示例"><span class="nav-number">2.3.3.</span> <span class="nav-text">rpmbuild spec 示例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#制作rpm包"><span class="nav-number">3.</span> <span class="nav-text">制作rpm包</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#上传必要的source文件"><span class="nav-number">3.1.</span> <span class="nav-text">上传必要的source文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#开始制作"><span class="nav-number">3.2.</span> <span class="nav-text">开始制作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#技巧总结"><span class="nav-number">3.3.</span> <span class="nav-text">技巧总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RPM-常用参数备忘"><span class="nav-number">4.</span> <span class="nav-text">RPM 常用参数备忘</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#其他"><span class="nav-number">5.</span> <span class="nav-text">其他</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#如何从python源码包构建rpm"><span class="nav-number">5.1.</span> <span class="nav-text">如何从python源码包构建rpm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#无污染地打rpm包"><span class="nav-number">5.2.</span> <span class="nav-text">无污染地打rpm包</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#总结"><span class="nav-number">6.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#引用"><span class="nav-number">7.</span> <span class="nav-text">引用</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">编程三分钟</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">54.5k</span></div><span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span> <span class="post-meta-divider">|</span> <span id="busuanzi_container_site_uv">总访客<span id="busuanzi_value_site_uv"></span>人</span> <span class="post-meta-divider">|</span> <span>Hosted by <a href="https://coding.net/pages">Coding Pages</a></span><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript" src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.js"></script><script type="text/javascript">$(function(){$("img").lazyload({placeholder:"/images/loading.gif",effect:"fadeIn"})})</script></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script><script type="text/javascript" src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.ui.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: 'BF8XolSeE4J2HMABoYuxSD6n-gzGzoHsz',
        appKey: 'HwWdwfKzwtNO8R26twaobfvY',
        placeholder: '评论支持markdown，邮箱选填，填写订阅回复通知',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("BF8XolSeE4J2HMABoYuxSD6n-gzGzoHsz","HwWdwfKzwtNO8R26twaobfvY")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js"></script></body></html><!-- rebuild by neat -->